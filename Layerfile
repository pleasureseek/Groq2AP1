# Start with a base image
FROM vm/ubuntu:18.04

# Note: Layerfiles create entire VMs, not just containers!

# Install prerequisites only once to avoid redundancy
RUN apt-get update && apt-get install -y \
        ca-certificates \
        curl \
        gnupg \
        lsb-release \
    && rm -rf /var/lib/apt/lists/*

# Set up Docker's official GPG key and repository
RUN mkdir -p /etc/apt/keyrings \
    && curl -fsSL https://download.docker.com/linux/ubuntu/gpg | gpg --dearmor -o /etc/apt/keyrings/docker.gpg \
    && echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" > /etc/apt/sources.list.d/docker.list

# Install Docker
RUN apt-get update && apt-get install -y \
        docker-ce \
        docker-ce-cli \
        containerd.io \
    && rm -rf /var/lib/apt/lists/*

# Copy all local files to the image
COPY . .

# Build and run Docker containers
RUN docker build -t myimage .
RUN docker run -d -p 80:80 myimage
RUN docker run -d -p 8080:8080 ghcr.io/star-studio-develop/groq2api:latest

# Expose port 80 for access
EXPOSE 80
